<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>After School</title>
  </head>
  <link rel="stylesheet" href="./index.css" type="text/css"/>
  
<script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>
<script src="./lessons.js"></script>
</head>
<body>
    
    <div id="app">
       <h1>After School Activities</h1>
       <!-- Disabling the cart only on the lesson Page -->
       <button class="cart" v-bind:disabled ="cart.length < 1 && currentPage !== 1"  v-on:click = "togglePage()">   
            <h3>Cart</h3>
           
            <svg xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 576 512"><!--! Font Awesome Pro 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
                <path
                    d="M0 24C0 10.7 10.7 0 24 0H69.5c22 0 41.5 12.8 50.6 32h411c26.3 0 45.5 25 38.6 50.4l-41 152.3c-8.5 31.4-37 53.3-69.5 53.3H170.7l5.4 28.5c2.2 11.3 12.1 19.5 23.6 19.5H488c13.3 0 24 10.7 24 24s-10.7 24-24 24H199.7c-34.6 0-64.3-24.6-70.7-58.5L77.4 54.5c-.7-3.8-4-6.5-7.9-6.5H24C10.7 48 0 37.3 0 24zM128 464a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm336-48a48 48 0 1 1 0 96 48 48 0 1 1 0-96z" />
            </svg>
    <p>{{cart.length}}</p>
       </button>
     <div  v-if ="currentPage === navigator.lessonPage" class="lessonPage">
        <div class="search-container">
        
            <input type="search" placeholder="Search Lessons" v-model="searchText" /><input type="button" value="search" />
        </div>
        
        <!-- Sort Tags -->
        <div class="sort-section">
        
            <div class="sort-type">
                <div>
                    <input type="radio" name="sort" value="subject" id="option1" v-model="sortType" /> <label
                        for="option1">Subject</label>
                </div>
                <div>
                    <input type="radio" name="sort" value="location" id="option2" v-model="sortType" /> <label
                        for="option2">Location</label>
                </div>
                <div>
                    <input type="radio" name="sort" value="price" id="option3" v-model="sortType" /> <label
                        for="option3">Price</label>
                </div>
                <div>
                    <input type="radio" name="sort" value="spaces" id="option4" v-model="sortType" /> <label
                        for="option4">Spaces</label>
                </div>
        
        
        
            </div>
            <div class="sort-mode">
                <div>
                    <input type="radio" name="mode" value="descending" id="descending" v-model="mode" /> <label
                        for="descending">Descending</label>
                </div>
                <div>
                    <input type="radio" name="mode" value="ascending" id="ascending" v-model="mode" /> <label
                        for="ascending">Ascending</label>
                </div>
        
            </div>
        
        
        
        </div>
        
        <!-- Lessons section -->
        <div class="lesson-container">
            <div class="image-card" v-for="(lesson,key) in sortedLessons" :key="lesson.subject">
                <div class="card-image"> <img :src="lesson.image" /></div>
                <div class="card-text">
        
                    <div v-for="(value, key) in lesson" :key="key" v-if="!['id','image'].includes(key)">
                        <h4>{{ key }}: {{ value }}</h4>
                    </div>
        
                </div>
                <div class="card-button"><button v-bind:disabled="lesson.spaces < 1" v-on:click="addToCart(lesson)">Add to
                        cart</button></div>
        
            </div>
        </div>
     </div> 
     
<div v-else-if ="currentPage === navigator.cartPage"  class="shoppingCartPage">
    <div class="cart-container">
        <div class="image-card" v-for="(lesson,key) in cart" :key="lesson.subject">
            <div class="card-image"> <img :src="lesson.image" /></div>
            <div class="card-text">
    
                <div v-for="(value, key) in lesson" :key="key"v-if="!['id','image'].includes(key)">
                    <h4>{{ key }}: {{ value }}</h4>
                </div>
    
            </div>
            <div class="card-button"><button  v-on:click="removeLesson(lesson)">Remove</button></div>
    
        </div>
    </div>
    <div class="checkout-container">
        <section>
            <h1> Checkout</h1>
        </section>
        <form>
            <div>
                <label for="name">Name :</label> <input v-model="order.name" id="name" type="phone" />
            </div>
            <div>
                <label for="name">Phone:</label> <input v-model="order.phone" id="name" type="text" />
            </div>
        </form>
       
        <div class="checkout-button"><button v-bind:disabled="isCheckoutDisabled" v-on:click="completeCheckout()">
                Checkout Order </button></div>
                <p v-if="isCheckoutDisabled === true" >{{order.errorMessage}}</p>
    </div>
    
</div>
     
     
      
    </div>
    
    

    <script>
        let app = new Vue({
            el:"#app",
            data:{
                welcome:"hello world",
                lessons,
                showSubject:true,
                sortType:'subject',
                mode:"ascending" , 
                query:"",
                searchText:"",
                cart:[],
                navigator:{
                    lessonPage:0,
                    cartPage:1,
                },
                currentPage:0,
                order:{
                    name:"",
                    phone:"",
                    errorMessage:"sss"
                }
             
            },
        
            methods:{
                addToCart : function(lesson){
                    let lessonInCart = this.cart.find((item) => item.id === lesson.id);
                    const increaseAmount = 1;
                    // check if lesson is already in cart
                    if (lessonInCart){
                        lessonInCart.spaces += 1 
                    }
                    else {
                        this.cart = [...this.cart, {...lesson,spaces:1}];
                    }
                    lesson.spaces--
                    
                },
                
                // review this code
                togglePage:function(){
                  this.currentPage = this.currentPage === 0 ? 1 : 0;
                    

                    
                },
                removeLesson:function (lesson) { 
                    let lessonInLessons = this.lessons.find((item) => item.id === lesson.id);
                   // remove the item if spaces less than zero
                    if(lesson.spaces <= 1){
                        this.cart = this.cart.filter((item) => item.id !== lesson.id);
                    }
                    else{
    
                        lesson.spaces -= 1;
                    }
                    lessonInLessons.spaces +=1
                    
                 },
                 completeCheckout:function (){
                    alert(`${this.order.name} your  order has been submitted`)
                 }
            },
              computed: {
                sortedLessons: function () {
                    let order = this.mode ==='ascending' ? 1 : -1;
                    return this.lessons.slice().filter((item)=>{
                        return (item.subject.toLowerCase().includes(this.searchText.toLowerCase()))  || (item.location.toLowerCase().includes(this.searchText.toLowerCase()))
                    }).sort((a, b) => {
                       if(typeof a[this.sortType] === 'string' && typeof b[this.sortType]==='string'){
                        
                           return order*(a[this.sortType].localeCompare(b[this.sortType]))
                       }
                       else{
                        return order * (a[this.sortType]-(b[this.sortType]))
                       }
                       
                }
                    )
            },
               isCheckoutDisabled: function(){
            let isValidName = ( this.order.name.trim().length > 0 ) && /^[A-Za-z\s]*$/.test(this.order.name)
            let isVaidNumber = (this.order.phone.trim().length > 0) && /^[0-9]*$/.test(this.order.phone)
            
           let isButtonDisabled = !(isVaidNumber && isValidName)
          this.order.errorMessage = "please enter a valid name and phone number"
           return isButtonDisabled;
            
           } 
            
        }
            
           
        })
    </script>
</body>
</html>